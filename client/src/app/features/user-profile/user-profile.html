<div class="mx-auto max-w-4xl px-6">
  @if (isLoading()) {
    <div class="flex items-center justify-center py-12">
      <div
        class="h-8 w-8 animate-spin rounded-full border-4 border-gray-200 border-t-blue-600"
        role="status"
        aria-label="loading"
      ></div>
    </div>
  } @else if (profile()) {
    <div class="mb-8 pt-8">
      <div class="flex items-start justify-between gap-6">
        <div class="flex items-start gap-6 min-w-0 flex-1">
          <div
            class="relative h-32 w-32 shrink-0 overflow-hidden rounded-full border-4 border-white shadow-xl bg-linear-to-br from-blue-500 to-blue-600 ring-2 ring-gray-100"
          >
            @if (profile()!.profilePictureUrl) {
              <img
                [src]="profile()!.profilePictureUrl"
                [alt]="displayName()"
                class="h-full w-full object-cover"
              />
            } @else {
              <div
                class="flex h-full w-full items-center justify-center text-3xl font-bold text-white"
              >
                {{ initials() }}
              </div>
            }
          </div>

          <div class="mt-1 min-w-0 flex-1">
            <h1 class="text-3xl font-bold text-gray-900 tracking-tight">
              {{ displayName() }}
            </h1>
            <p class="text-gray-500 mt-0.5">@{{ profile()!.username }}</p>

            @if (profile()!.bio) {
              <p class="mt-4 max-w-2xl text-gray-700 leading-relaxed">{{ profile()!.bio }}</p>
            }

            <div class="mt-4 flex items-center gap-2 text-sm">
              <div class="flex items-center gap-1.5 text-gray-500">
                <z-icon zType="mail" />
                <span>{{ profile()?.email }}</span>
              </div>
            </div>

            <div class="mt-5 flex gap-8">
              <div
                (click)="openFollowListDialog('following')"
                class="cursor-pointer transition-all hover:scale-105"
              >
                <span class="font-semibold text-gray-900 text-lg">
                  {{ formattedFollowing() }}
                </span>
                <span class="ml-1.5 text-gray-500 text-sm">Following</span>
              </div>
              <div
                (click)="openFollowListDialog('followers')"
                class="cursor-pointer transition-all hover:scale-105"
              >
                <span class="font-semibold text-gray-900 text-lg">
                  {{ formattedFollowers() }}
                </span>
                <span class="ml-1.5 text-gray-500 text-sm">Followers</span>
              </div>
            </div>
          </div>
        </div>

        @if (!isMyProfile()) {
          <div class="flex gap-2 shrink-0">
            <button
              (click)="handleFollow()"
              [disabled]="isFollowLoading()"
              [ngClass]="{
                'bg-gray-100 text-gray-700 hover:bg-gray-200 focus:ring-gray-300 border border-gray-300 disabled:opacity-60 disabled:cursor-not-allowed':
                  isFollowing(),
                'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 shadow-sm disabled:opacity-60 disabled:cursor-not-allowed':
                  !isFollowing(),
              }"
              class="rounded-full px-6 py-2.5 font-semibold transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 active:scale-95"
            >
              @if (isFollowLoading()) {
                <span
                  class="inline-block h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent mr-2"
                ></span>
                {{ isFollowing() ? 'Unfollowing...' : 'Following...' }}
              } @else {
                {{ isFollowing() ? 'Following' : 'Follow' }}
              }
            </button>
          </div>
        } @else {
          <div class="flex gap-2 shrink-0">
            <button
              (click)="openEditProfileDialog()"
              z-button
              zType="outline"
              class="flex items-center gap-2"
            >
              <z-icon zType="pencil" [zSize]="'sm'" />
              Edit Profile
            </button>
          </div>
        }
      </div>
    </div>

    <!-- Posts Section -->
    <div class="pb-12">
      @if (userId()) {
        <app-feed [userId]="userId()!"></app-feed>
      }
    </div>
  }
</div>
