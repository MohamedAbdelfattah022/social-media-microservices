<div
  class="group flex gap-3 px-4 py-3.5 hover:bg-gray-50/60 dark:hover:bg-white/2 transition-colors"
>
  <!-- Avatar -->
  <button
    type="button"
    class="shrink-0 mt-0.5 rounded-full ring-2 ring-transparent hover:ring-blue-400 dark:hover:ring-blue-500 transition-all"
    (click)="navigateToProfile()"
    [attr.aria-label]="'View profile of ' + comment().firstname"
  >
    @if (comment().profilePictureUrl) {
      <img
        [src]="comment().profilePictureUrl"
        [alt]="comment().firstname"
        class="w-9 h-9 rounded-full object-cover"
      />
    } @else {
      <div
        class="w-9 h-9 rounded-full bg-linear-to-br from-blue-400 to-indigo-500 dark:from-blue-500 dark:to-indigo-600 flex items-center justify-center text-[11px] font-bold text-white select-none"
      >
        {{ (comment().firstname + ' ' + comment().lastname).slice(0, 2).toUpperCase() }}
      </div>
    }
  </button>

  <!-- Body -->
  <div class="flex-1 min-w-0">
    <!-- Bubble -->
    <div
      class="inline-block max-w-full bg-gray-100 dark:bg-gray-800 rounded-2xl rounded-tl-sm px-3.5 py-2.5"
    >
      <!-- Name row -->
      <div class="flex items-baseline gap-2 flex-wrap">
        <button
          type="button"
          class="text-sm font-semibold text-gray-900 dark:text-white leading-tight hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
          (click)="navigateToProfile()"
        >
          {{ comment().firstname }} {{ comment().lastname }}
        </button>
        @if (comment().username) {
          <span class="text-xs text-gray-400 dark:text-gray-500">@{{ comment().username }}</span>
        }
      </div>
      <!-- Content -->
      <p
        class="mt-1 text-[14.5px] leading-relaxed text-gray-800 dark:text-gray-200 whitespace-pre-wrap wrap-break-word"
      >
        {{ comment().content }}
      </p>
    </div>

    <!-- Meta + Actions row -->
    <div class="flex items-center gap-3 mt-1.5 pl-1">
      <span class="text-xs text-gray-400 dark:text-gray-500">{{ commentDate }}</span>
      @if (comment().isEdited) {
        <span class="text-xs text-gray-400 dark:text-gray-500 italic">Edited</span>
      }

      <button
        type="button"
        class="flex items-center gap-1 text-xs font-medium transition-colors disabled:opacity-40 disabled:cursor-not-allowed"
        [class]="
          isLiked()
            ? 'text-red-500 dark:text-red-400'
            : 'text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:text-red-400'
        "
        [disabled]="isLiking()"
        (click)="handleLike()"
      >
        <z-icon zType="heart" class="w-3.5 h-3.5" [class]="isLiked() ? 'fill-current' : ''" />
        @if (comment().likeCount > 0) {
          <span>{{ comment().likeCount }}</span>
        } @else {
          <span>Like</span>
        }
      </button>

      <button
        type="button"
        class="text-xs font-medium text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
        (click)="handleReply()"
      >
        Reply
      </button>

      @if (comment().replyCount > 0) {
        <button
          type="button"
          class="flex items-center gap-1 text-xs font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors"
          (click)="handleViewReplies()"
        >
          <z-icon zType="chevron-down" class="w-3 h-3" />
          {{ comment().replyCount }} {{ comment().replyCount === 1 ? 'reply' : 'replies' }}
        </button>
      }

      <!-- Options menu -->
      @if (isOwnComment()) {
        <div class="ml-auto opacity-0 group-hover:opacity-100 transition-opacity">
          <button
            type="button"
            z-menu
            [zMenuTriggerFor]="commentMenu"
            class="p-1 rounded-full text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
          >
            <z-icon zType="ellipsis" class="h-4 w-4" />
          </button>

          <ng-template #commentMenu>
            <div z-menu-content class="w-40">
              <button type="button" z-menu-item (click)="handleEdit()">
                <z-icon zType="pencil" class="mr-2" />
                <span>Edit</span>
              </button>
              <button type="button" z-menu-item zType="destructive" (click)="handleDelete()">
                <z-icon zType="trash" class="mr-2" />
                <span>Delete</span>
              </button>
            </div>
          </ng-template>
        </div>
      }
    </div>
  </div>
</div>
