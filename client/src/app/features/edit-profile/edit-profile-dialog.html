<form [formGroup]="form" (ngSubmit)="onSave()" class="space-y-6 w-full">
  <!-- Avatar Section -->
  <div class="flex flex-col items-center gap-3">
    <div class="relative">
      <div
        class="h-24 w-24 rounded-full overflow-hidden border-4 border-white shadow-md bg-linear-to-br from-blue-500 to-blue-600 ring-2 ring-gray-100 flex items-center justify-center"
      >
        @if (currentAvatarUrl()) {
          <img
            [src]="currentAvatarUrl()!"
            alt="Avatar preview"
            class="h-full w-full object-cover"
          />
        } @else {
          <span class="text-2xl font-bold text-white select-none">{{ initials() }}</span>
        }
      </div>

      <!-- Loading overlay -->
      @if (isDeletingPicture()) {
        <div class="absolute inset-0 rounded-full bg-black/40 flex items-center justify-center">
          <div
            class="h-5 w-5 animate-spin rounded-full border-2 border-white border-t-transparent"
          ></div>
        </div>
      }

      <!-- Camera button -->
      @if (!isDeletingPicture()) {
        <label
          for="avatar-upload"
          class="absolute bottom-0 right-0 h-8 w-8 rounded-full bg-blue-600 text-white flex items-center justify-center cursor-pointer shadow hover:bg-blue-700 transition-colors"
          title="Upload photo"
        >
          <z-icon zType="camera" [zSize]="'sm'" />
          <input
            id="avatar-upload"
            type="file"
            accept="image/jpeg,image/png,image/gif,image/webp"
            class="sr-only"
            (change)="onAvatarFileSelected($event)"
          />
        </label>
      }
    </div>

    <!-- Remove picture button -->
    @if (currentAvatarUrl() && !isDeletingPicture()) {
      <button
        type="button"
        (click)="onRemoveAvatar()"
        class="text-sm text-red-500 hover:text-red-700 transition-colors flex items-center gap-1"
      >
        <z-icon zType="trash-2" [zSize]="'sm'" />
        Remove photo
      </button>
    }
  </div>

  <!-- First Name -->
  <div class="space-y-1.5">
    <label for="firstName" class="block text-sm font-medium text-gray-700">First Name</label>
    <input
      id="firstName"
      type="text"
      formControlName="firstName"
      placeholder="Enter your first name"
      class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
    />
    @if (form.controls.firstName.invalid && form.controls.firstName.touched) {
      <p class="text-xs text-red-600">
        @if (form.controls.firstName.errors?.['required']) {
          First name is required.
        } @else if (form.controls.firstName.errors?.['maxlength']) {
          First name must be at most 50 characters.
        }
      </p>
    }
  </div>

  <!-- Last Name -->
  <div class="space-y-1.5">
    <label for="lastName" class="block text-sm font-medium text-gray-700">Last Name</label>
    <input
      id="lastName"
      type="text"
      formControlName="lastName"
      placeholder="Enter your last name"
      class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
    />
    @if (form.controls.lastName.invalid && form.controls.lastName.touched) {
      <p class="text-xs text-red-600">
        @if (form.controls.lastName.errors?.['required']) {
          Last name is required.
        } @else if (form.controls.lastName.errors?.['maxlength']) {
          Last name must be at most 50 characters.
        }
      </p>
    }
  </div>

  <!-- Bio -->
  <div class="space-y-1.5">
    <label for="bio" class="block text-sm font-medium text-gray-700">
      Bio
      <span class="text-gray-400 font-normal ml-1">(optional)</span>
    </label>
    <textarea
      id="bio"
      formControlName="bio"
      rows="3"
      placeholder="Tell people a little about yourself..."
      class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all"
    ></textarea>
    <div class="flex justify-between items-center">
      @if (form.controls.bio.invalid && form.controls.bio.touched) {
        <p class="text-xs text-red-600">Bio must be at most 300 characters.</p>
      } @else {
        <span></span>
      }
      <span class="text-xs text-gray-400">{{ form.controls.bio.value.length }}/300</span>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex justify-end gap-3 pt-2">
    <button
      type="button"
      z-button
      zType="outline"
      (click)="onCancel()"
      [disabled]="isSaving() || isUploadingPicture()"
    >
      Cancel
    </button>
    <button
      type="submit"
      z-button
      zType="default"
      [disabled]="form.invalid || isSaving() || isUploadingPicture() || isDeletingPicture()"
    >
      @if (isSaving()) {
        <span
          class="inline-block h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent mr-2"
        ></span>
        Saving...
      } @else {
        Save changes
      }
    </button>
  </div>
</form>
