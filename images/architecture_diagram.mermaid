---
config:
  layout: elk
---
flowchart LR
 subgraph subGraph0["Edge Layer"]
        Gateway["API Gateway<br>(Spring Cloud Gateway)"]
  end
 subgraph Infrastructure["Infrastructure"]
        Discovery["Service Discovery<br>(Netflix Eureka)"]
        Config["Config Server<br>(Spring Cloud Config)"]
        Auth["Auth Service<br>(Spring Security / OAuth2)"]
  end
 subgraph subGraph2["Core Services"]
        UserService["User Service"]
        PostService["Post Service"]
        InteractionService["Interaction Service"]
        MediaService["Media Service"]
  end
 subgraph subGraph3["Real-time & Async"]
        ChatService["Chat Service"]
        NotifService["Notification Service"]
        FeedService["Feed Service"]
        RankingService["Ranking Service"]
  end
 subgraph subGraph4["Persistence Layer"]
        UserDB[("User DB<br>PostgreSQL")]
        PostDB[("Post DB<br>MongoDB")]
        InteractionDB[("Interaction DB<br>PostgreSQL")]
        ChatDB[("Chat DB<br>Cassandra/MongoDB")]
        MinIO[("MinIO<br>(Object Storage)")]
        Redis[("Redis Cluster<br>(General Cache &amp; Feeds)")]
  end
    ClientWeb["Web Client"] -- REST/HTTPS --> Gateway
    ClientMobile["Mobile Client"] -- REST/HTTPS --> Gateway
    Gateway -- Validate Token --> Auth
    Gateway -- User Profile/Graph --> UserService
    Gateway -- Create/Get Posts --> PostService
    Gateway -- Like/Comment --> InteractionService
    Gateway -- WebSocket Chat --> ChatService
    Gateway -- Get News Feed --> FeedService
    UserService -- Persist User Data --> UserDB
    PostService -- Persist Post Data --> PostDB
    PostService -- Store Images/Video --> MediaService
    MediaService -- Store Files --> MinIO
    InteractionService -- Persist Interactions --> InteractionDB
    ChatService -- Persist Messages --> ChatDB
    UserService -- Cache Profiles --> Redis
    PostService -- Cache Popular Posts --> Redis
    InteractionService -- Cache Counts --> Redis
    FeedService -- Store/Retrieve Feed --> Redis
    FeedService -- Get Ranked Posts --> RankingService
    FeedService -- Fetch Post Details --> PostService
    FeedService -- Fetch User Details --> UserService
    PostService -. Post Created Event .-> MsgQueue["Message Queue<br>(Kafka/RabbitMQ)"]
    InteractionService -. Interaction Event .-> MsgQueue
    MsgQueue -. Consume Events .-> NotifService
    MsgQueue -. "Fan-out to Feeds" .-> FeedService
    Gateway -. Register/Lookup .-> Discovery
    UserService -. Register .-> Discovery
    PostService -. Register .-> Discovery
    UserService -. Fetch Config .-> Config
    PostService -. Fetch Config .-> Config

    style subGraph2 fill:#FFFFFF